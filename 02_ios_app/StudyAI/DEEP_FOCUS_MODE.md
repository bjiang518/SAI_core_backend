# 深度专注模式功能说明

## 🌙 概述

深度专注模式是番茄专注功能的增强版，旨在创造一个完全无干扰的专注环境。启用后，App会自动优化环境设置，屏蔽通知和干扰，帮助用户进入深度专注状态。

---

## ✨ 核心功能

### 1. 自动通知屏蔽 🔇
- **屏蔽App内通知**：暂停所有非番茄专注相关的通知
- **保留番茄专注提醒**：保留专注开始提醒，确保不错过预约的专注时间
- **清空已展示通知**：移除通知栏中的所有已显示通知

### 2. 环境优化 🔅
- **降低屏幕亮度**：自动降低到50%亮度，保护眼睛
- **优化音频会话**：设置为专注模式音频配置
- **自动恢复设置**：结束时恢复原始设置

### 3. 系统专注模式建议 💡
- **智能提醒**：建议用户启用iOS系统勿扰模式
- **快速引导**：提供控制中心快速启用指南
- **设置教程**：详细的iOS专注模式设置教程

### 4. 统计追踪 📊
- **会话统计**：记录深度专注会话次数
- **时长追踪**：统计总深度专注时间
- **通知统计**：记录屏蔽的通知数量

---

## 🎨 用户界面

### 开始前界面
```
┌────────────────────────────────────┐
│ 🌙 深度专注模式                    │
│    屏蔽通知和干扰                  │
│                        ℹ️   [开关] │
└────────────────────────────────────┘

💡 建议在控制中心手动启用「勿扰模式」以获得最佳效果
```

### 运行中界面
```
┌────────────────────────────────────┐
│ 🌙 深度专注模式已启用               │
│    通知已屏蔽 · 环境优化中      ✕  │
└────────────────────────────────────┘
```

**特点：**
- 🟣 紫色主题（代表专注和宁静）
- 🌙 月亮图标（象征深度专注）
- ℹ️ 信息按钮（查看使用指南）
- ✕ 快速关闭（运行中可手动禁用）

---

## 🔧 技术实现

### 核心服务：DeepFocusService

```swift
class DeepFocusService: ObservableObject {
    // 发布属性
    @Published var isDeepFocusEnabled: Bool
    @Published var blockedNotificationsCount: Int

    // 核心方法
    func enableDeepFocus()        // 启用深度专注
    func disableDeepFocus()       // 禁用深度专注
    func toggleDeepFocus()        // 切换状态
}
```

### 集成到FocusSessionService

```swift
// 启动专注时自动启用
func startSession(withMusic: String?, enableDeepFocus: Bool)

// 结束时自动禁用
func endSession() {
    if isDeepFocusEnabled {
        deepFocusService.disableDeepFocus()
    }
}

// 手动切换
func toggleDeepFocus()
```

### UI组件

**开始前：** `deepFocusToggleSection`
- Toggle开关
- 说明文字
- 信息按钮
- 提示横幅（启用时显示）

**运行中：** `deepFocusStatusBanner`
- 状态显示
- 快速关闭按钮
- 紫色渐变背景

---

## 📱 用户体验流程

### 场景1：首次使用
```
1. 打开番茄专注
2. 看到"深度专注模式"开关
3. 点击 ℹ️ 按钮查看说明
4. 阅读系统设置指南
5. 启用开关
6. 开始25分钟专注
7. App自动：
   - 屏蔽通知
   - 降低亮度
   - 显示提示：建议启用系统勿扰模式
8. 用户手动开启控制中心 → 勿扰模式
9. 进入完全无干扰状态
```

### 场景2：再次使用（自动启用）
```
1. 设置中启用"自动启用深度专注"
2. 打开番茄专注 → 开始
3. 自动启用深度专注模式
4. 无需手动切换
```

### 场景3：运行中关闭
```
1. 专注进行中
2. 点击深度专注横幅上的 ✕ 按钮
3. 立即禁用深度专注
4. 恢复通知和亮度
5. 继续番茄专注（不中断计时）
```

---

## 🛡️ iOS系统专注模式集成

### 为什么需要手动启用系统勿扰模式？

iOS出于安全和隐私考虑，不允许第三方App直接控制系统级别的勿扰模式。但我们提供了以下解决方案：

### 1. App级别功能（自动）
✅ 屏蔽App内通知
✅ 优化环境设置
✅ 智能提醒用户

### 2. 系统级别功能（手动）
🔵 完全屏蔽来电
🔵 屏蔽所有App通知
🔵 隐藏锁屏通知
🔵 多设备同步

### 3. 我们的引导方案

**智能提醒通知：**
```
💡 提示
建议开启系统勿扰模式以获得最佳专注效果
下拉控制中心 → 点击专注模式
```

**详细设置指南：**
```
📱 如何设置系统专注模式：

1. 打开「设置」→「专注模式」
2. 点击「+」创建新的专注模式
3. 选择「自定」
4. 命名为「学习专注」
5. 在「允许的通知」中只添加重要联系人
6. 在「屏幕」设置中隐藏通知角标
7. 返回控制中心即可快速启用

💡 提示：
- StudyAI会自动提醒您开启专注模式
- 您也可以在Siri中说"开启学习专注"
```

**快捷操作按钮：**
- "查看设置指南" → 打开iOS设置App

---

## 🎯 深度专注的优势

### vs 普通番茄专注

| 功能 | 普通模式 | 深度专注模式 |
|------|----------|--------------|
| 25分钟倒计时 | ✅ | ✅ |
| 背景音乐 | ✅ | ✅ |
| 树木奖励 | ✅ | ✅ |
| App内通知屏蔽 | ❌ | ✅ |
| 自动降低亮度 | ❌ | ✅ |
| 系统勿扰建议 | ❌ | ✅ |
| 统计追踪 | ❌ | ✅ |
| 环境优化 | ❌ | ✅ |

### 适用场景

**推荐使用深度专注：**
- 📚 准备重要考试
- 📝 完成复杂作业
- 🎯 需要高度集中注意力的任务
- 📖 深度阅读和学习
- 💻 编程和创作

**可选普通模式：**
- ✏️ 日常练习
- 📄 轻度阅读
- 🎵 纯粹听音乐专注

---

## 📊 统计与分析

### 可追踪数据

```swift
struct FocusStatistics {
    var totalSessions: Int             // 总会话数
    var totalFocusTime: TimeInterval   // 总专注时间
    var notificationsBlocked: Int      // 屏蔽的通知数
}
```

### 数据持久化
- **存储位置**：UserDefaults
- **存储键**：
  - `deepFocusSessions` - 会话数
  - `deepFocusTotalTime` - 总时长
  - `deepFocusBlockedNotifications` - 屏蔽数

### 未来功能扩展
- [ ] 深度专注统计图表
- [ ] 每周深度专注报告
- [ ] 与普通专注对比分析
- [ ] 深度专注成就徽章

---

## ⚙️ 用户设置

### 自动启用选项

```swift
var autoEnableDeepFocus: Bool
```

**存储键：** `autoEnableDeepFocus`

**用途：** 每次开始番茄专注时自动启用深度专注模式，无需手动切换开关。

**设置位置：** （未来）设置页面中的"番茄专注设置"

---

## 🎨 视觉设计规范

### 颜色主题
- **主色**：紫色 `Color.purple`
- **渐变**：紫色到半透明
- **图标**：月亮 `moon` / `moon.fill`
- **强调色**：橙色（提示）`Color.orange`

### 图标语义
- 🌙 月亮：深度专注、宁静、夜间学习
- 🔇 静音：通知屏蔽
- 🔅 亮度：环境优化
- 💡 灯泡：提示和建议

### 交互反馈
- **开关切换**：中等强度震动反馈
- **启用成功**：UIImpactFeedbackGenerator (medium)
- **禁用成功**：UIImpactFeedbackGenerator (light)

---

## 🔒 隐私和权限

### 不需要额外权限
深度专注模式完全基于App内功能实现，**不需要请求额外的系统权限**。

### 数据隐私
- ✅ 所有数据存储在本地（UserDefaults）
- ✅ 不收集用户隐私信息
- ✅ 不上传到服务器
- ✅ 用户完全控制

### 通知管理
- 仅管理App内通知
- 不访问其他App的通知
- 恢复时不会丢失通知

---

## 🚀 最佳实践建议

### 给用户的建议

**第一次使用：**
1. 阅读深度专注模式说明
2. 按照指南配置iOS系统专注模式
3. 在控制中心添加专注模式快捷方式
4. 尝试一次完整的25分钟深度专注

**日常使用：**
1. 开启深度专注模式
2. 手动启用控制中心的勿扰模式
3. 戴上耳机，选择合适的背景音乐
4. 专注25分钟，不看手机

**高级技巧：**
1. 使用Siri快捷指令快速启动
2. 设置专注模式时间表（自动启动）
3. 在系统设置中将StudyAI加入「允许的App」
4. 使用多设备专注模式同步

---

## 📚 相关文档

- `POMODORO_FEATURE_SUMMARY.md` - 番茄专注功能总览
- [Apple Human Interface Guidelines - Focus](https://developer.apple.com/design/human-interface-guidelines/patterns/managing-notifications)
- [iOS Focus Filters](https://developer.apple.com/documentation/appintents/focus-filter-intents)

---

## 🎉 总结

深度专注模式提供了：
✅ App级别的通知屏蔽
✅ 智能环境优化
✅ 系统专注模式引导
✅ 完整的统计追踪
✅ 流畅的用户体验

虽然无法直接控制系统勿扰模式，但通过智能引导和App内优化，我们创造了一个高效的深度专注环境，帮助用户达到最佳专注状态！

---

**创建日期：** 2025年11月6日
**版本：** v1.0
**状态：** ✅ 开发完成
